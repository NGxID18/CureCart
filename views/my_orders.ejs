<%- include('_header', { title: 'Riwayat Pesanan Saya' }) %>

<h1>Riwayat Pesanan Saya</h1>
<p class.="lead">Lacak semua pesanan Anda di sini.</p>

<div class="card shadow-sm">
    <div class="table-responsive">
        <table class="table table-striped table-hover mb-0 align-middle">
            <thead class="table-dark">
                <tr>
                    <th>ID Pesanan</th>
                    <th>Tanggal</th>
                    <th>Total</th>
                    <th>Status</th>
                    <th>Aksi</th>
                </tr>
            </thead>
            <tbody>
                <% if (orders.length > 0) { %>
                    <% orders.forEach(order => { %>
                        <tr>
                            <td>
                                <a href="/invoice/<%= order.id %>"><strong>#<%= order.id %></strong></a>
                            </td>
                            <td><%= new Date(order.created_at).toLocaleDateString('id-ID') %></td>
                            <td>Rp <%= Number(order.total_amount).toLocaleString('id-ID') %></td>
                            <td>
                                <% if (order.status === 'Paid') { %>
                                    <span class="badge bg-success">Dibayar (Diproses)</span>
                                <% } else if (order.status === 'Shipped') { %>
                                    <span class="badge bg-primary">Terkirim</span>
                                <% } else if (order.status === 'Pending') { %>
                                    <span class="badge bg-warning text-dark">Menunggu Pembayaran</span>
                                <% } else if (order.status === 'Cancelled_By_User') { %>
                                    <span class="badge bg-danger">Dibatalkan</span>
                                <% } else { %>
                                    <span class="badge bg-secondary"><%= order.status %></span>
                                <% } %>
                            </td>
                            <td>
                                <% if (order.status === 'Paid') { %>
                                    <form action="/my-orders/cancel/<%= order.id %>" method="POST" class="d-inline">
                                        <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Yakin ingin membatalkan pesanan ini?')">
                                            Batalkan Pesanan
                                        </button>
                                    </form>
                                <% } else { %>
                                    <a href="/invoice/<%= order.id %>" class="btn btn-info btn-sm">Lihat Detail</a>
                                <% } %>
                            </td>
                        </tr>
                    <% }) %>
                <% } else { %>
                    <tr>
                        <td colspan="5" class="text-center p-4">Anda belum memiliki riwayat pesanan.</td>
                    </tr>
                <% } %>
            </tbody>
        </table>
    </div>
</div>

<%- include('_footer') %>