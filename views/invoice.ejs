<%- include('_header', { title: 'Invoice #' + order.id }) %>

<% if (locals.from_checkout === 'true') { %>
    <div class="alert alert-success reveal-on-scroll" role="alert">
        <h4 class="alert-heading">Pembayaran Berhasil!</h4>
        <p>Terima kasih atas pesanan Anda. Pesanan Anda sedang kami proses.</p>
    </div>
<% } %>

<% if (order.status === 'Cancelled_By_User') { %>
    <div class="alert alert-danger reveal-on-scroll" role="alert">
        <h4 class="alert-heading">Pesanan Dibatalkan</h4>
        <p>Pesanan ini telah dibatalkan. Stok produk telah dikembalikan.</p>
    </div>
<% } %>

<div class="card reveal-on-scroll">
    <div class="card-header">
        <h2>Invoice #<%= order.id %></h2>
    </div>
    <div class="card-body">
        <div class="row mb-3">
            <div class="col-md-6">
                <strong>Tanggal:</strong> <%= new Date(order.created_at).toLocaleDateString('id-ID') %>
            </div>
            <div class="col-md-6 text-md-end">
                <strong>Status:</strong> 
                <% if (order.status === 'Paid') { %>
                    <span class="badge bg-success fs-6">Dibayar (Diproses)</span>
                <% } else if (order.status === 'Shipped') { %>
                    <span class="badge bg-primary fs-6">Terkirim</span>
                <% } else if (order.status === 'Pending') { %>
                    <span class="badge bg-warning text-dark fs-6">Menunggu Pembayaran</span>
                <% } else if (order.status === 'Cancelled_By_User') { %>
                    <span class="badge bg-danger fs-6">Dibatalkan</span>
                <% } else { %>
                    <span class="badge bg-secondary fs-6"><%= order.status %></span>
                <% } %>
            </div>
        </div>

        <h4>Detail Pesanan:</h4>
        <table class="table table-bordered">
            <thead class="table-light">
                <tr>
                    <th>Produk</th>
                    <th>Jumlah</th>
                    <th>Harga Satuan</th>
                    <th>Subtotal</th>
                </tr>
            </thead>
            <tbody>
                <% items.forEach(item => { %>
                    <tr>
                        <td><%= item.name %></td>
                        <td><%= item.quantity %></td>
                        <td>Rp <%= Number(item.price_at_purchase).toLocaleString('id-ID') %></td>
                        <td>Rp <%= Number(item.quantity * item.price_at_purchase).toLocaleString('id-ID') %></td>
                    </tr>
                <% }) %>
            </tbody>
            <tfoot class="table-light">
                <tr>
                    <td colspan="3" class="text-end"><strong>Total Pembayaran:</strong></td>
                    <td><strong>Rp <%= Number(order.total_amount).toLocaleString('id-ID') %></strong></td>
                </tr>
            </tfoot>
        </table>

        <hr>
        <div class="text-center">
            <a href="/invoice/<%= order.id %>/pdf" class="btn btn-success btn-lg">
                Download Invoice (.pdf)
            </a>
            <a href="/" class="btn btn-primary btn-lg">
                Kembali ke Toko
            </a>
        </div>
    </div>
</div>

<%- include('_footer') %>